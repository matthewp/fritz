<!doctype html>
<html>
<head>
  <title>Event tests</title>
  <link rel="import" href="../node_modules/mocha-test/mocha-test.html">
  <style>
    iframe { display: none; }
  </style>
</head>
<body>
  <iframe id="basicsFrame" src="./events/index.html"></iframe>
  <mocha-test>
    <template>
      <script>
        describe('Basics', function(){
          const win = basicsFrame.contentWindow;
          const doc = basicsFrame.contentDocument;

          before(function(done) {
            setTimeout(done, 100);
          });

          it('clicking a link changes the text', function(done){
            let shadow = doc.querySelector('event-element').shadowRoot;
            let anchor = shadow.querySelector('a');
            anchor.dispatchEvent(new Event('click'));

            setTimeout(function(){
              let clicked = shadow.querySelector('.clicked');
              assert.ok(clicked, 'rendering changed');
              done();
            }, 50);

            let spec = shadow.querySelector('#foo');
            assert.equal(spec.textContent, 'bar', 'This element was updated');

            // Custom events from child components to parents
            let thing = shadow.querySelector('#thing');
            assert.equal(thing.textContent, 'hello', 'This element updated');
          });
        });

        describe('Inputs', function(){
          const win = basicsFrame.contentWindow;
          const doc = basicsFrame.contentDocument;

          before(function(done) {
            setTimeout(done, 100);
          });

          it('Input events send the input\'s value', function(done){
            let shadow = doc.querySelector('input-el').shadowRoot;
            let input = shadow.querySelector('input');
            let result = shadow.querySelector('.result');

            assert.equal(result.textContent, '');

            input.value = 'hello';
            input.dispatchEvent(new Event('keyup'));

            setTimeout(function(){
              assert.equal(result.textContent, 'hello');
              done();
            }, 50);
          });
        });
      </script>
    </template>
  </mocha-test>
</body>
</html>
